# Template file for 'nagios'
pkgname=nagios
version=4.4.6
revision=1
build_style=gnu-configure

_nagios_user="_nagios"
_nagios_group="_nagios"
_vardir="/var/nagios"
_confdir="/etc/nagios"
_webdir="/usr/share/nagios"
_checkresultdir="/var/nagios/spool/checkresults"
_cgibindir="/usr/libexec/nagios/cgi"

configure_args="
 --with-nagios-user=$_nagios_user
 --with-nagios-group=$_nagios_group
 --localstatedir=$_vardir
 --sysconfdir=$_confdir
 --with-httpd-conf=$_httpdconfdir
 --with-checkresultdir=$_checkresultdir
 --with-cgibindir=$_cgibindir
 --with-webdir=$_webdir
 --enable-embedded-perl"
make_build_args="all"
make_install_args="install install-config"

hostmakedepends="perl unzip"
make_dirs="
$_vardir 0770 _nagios _nagios
$_vardir/rw 0770 _nagios _nagios
$_vardir/spool 0770 _nagios _nagios
$_vardir/spool/checkresults 0770 _nagios _nagios"
conf_files="/etc/nagios/nagios.cfg"

short_desc="Nagios Core monitoring and alerting engine"
maintainer="Dave Eddy <dave@daveeddy.com>"
license="GPL-2.0-or-later"

homepage="https://github.com/NagiosEnterprises/nagioscore"
changelog="${homepage}/blob/master/Changelog"
distfiles="${homepage}/releases/download/${pkgname}-${version}/${pkgname}-${version}.tar.gz"

checksum=ab0d5a52caf01e6f4dcd84252c4eb5df5a24f90bb7f951f03875eef54f5ab0f4
system_accounts="${_nagios_user}"

post_install() {
	# nagios has these set as 770 by default (owner and group are both
	# "root").  Leaving these as 770 and executing nagios as root results
	# in an error.
	chmod 755 "$DESTDIR/$_bindir/nagios"
	chmod 755 "$DESTDIR/$_bindir/nagiostats"

	vsv nagios
}
